<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Modeling Multiple Outputs &mdash; OpenMDAO Documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.13.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="OpenMDAO Documentation" href="../../index.html" />
    <link rel="up" title="MetaModel" href="index.html" />
    <link rel="next" title="MDAO Architectures" href="../mdao/index.html" />
    <link rel="prev" title="Using a MetaModel Component" href="single_output.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../mdao/index.html" title="MDAO Architectures"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="single_output.html" title="Using a MetaModel Component"
             accesskey="P">previous</a> |</li>
  <li><a href="http://openmdao.org">OpenMDAO Home</a> &raquo;</li>
  
        <li><a href="../../index.html">OpenMDAO Documentation v0.13.0</a> &raquo;</li>

          <li><a href="../index.html" >OpenMDAO Tutorials</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">MetaModel</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="modeling-multiple-outputs">
<span id="index-0"></span><h1>Modeling Multiple Outputs<a class="headerlink" href="#modeling-multiple-outputs" title="Permalink to this headline">Â¶</a></h1>
<p>This tutorial is a short demonstration of how to construct a MetaModel of a
component with multiple outputs. This tutorial builds off of the
<a class="reference internal" href="single_output.html#using-a-metamodel-component"><em>single-output tutorial</em></a>, with
modifications for multiple outputs in a component.</p>
<p>We created a new component called <tt class="docutils literal"><span class="pre">Trig()</span></tt>. This component has one input and two
outputs, both of which will be mimicked by the MetaModel.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">openmdao.main.api</span> <span class="kn">import</span> <span class="n">Assembly</span><span class="p">,</span> <span class="n">Component</span><span class="p">,</span> <span class="n">set_as_top</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span>

<span class="kn">from</span> <span class="nn">openmdao.lib.datatypes.api</span> <span class="kn">import</span> <span class="n">Float</span>
<span class="kn">from</span> <span class="nn">openmdao.lib.drivers.api</span> <span class="kn">import</span> <span class="n">DOEdriver</span>
<span class="kn">from</span> <span class="nn">openmdao.lib.doegenerators.api</span> <span class="kn">import</span> <span class="n">FullFactorial</span><span class="p">,</span> <span class="n">Uniform</span>
<span class="kn">from</span> <span class="nn">openmdao.lib.components.api</span> <span class="kn">import</span> <span class="n">MetaModel</span>
<span class="kn">from</span> <span class="nn">openmdao.lib.casehandlers.api</span> <span class="kn">import</span> <span class="n">DBCaseRecorder</span>
<span class="kn">from</span> <span class="nn">openmdao.lib.surrogatemodels.api</span> <span class="kn">import</span> <span class="n">LogisticRegression</span><span class="p">,</span> <span class="n">FloatKrigingSurrogate</span>


<span class="k">class</span> <span class="nc">Trig</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">iotype</span><span class="o">=</span><span class="s">&quot;in&quot;</span><span class="p">,</span><span class="n">units</span><span class="o">=</span><span class="s">&quot;rad&quot;</span><span class="p">)</span>

    <span class="n">f_x_sin</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="n">iotype</span><span class="o">=</span><span class="s">&quot;out&quot;</span><span class="p">)</span>
    <span class="n">f_x_cos</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="n">iotype</span><span class="o">=</span><span class="s">&quot;out&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f_x_sin</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f_x_cos</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p>This next section differs from the the previous example in that there are two surrogate models,  one
specified for each of the outputs. Note that each of the outputs had been assigned  a specific
surrogate model, a logistic regression for sin, and a Kriging Surrogate for cos. In this case,  no
default was set at all.</p>
<p>The parameter <cite>x</cite> still needs to be added only once in this case, since the same input
is being evaluated for both outputs.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Simulation</span><span class="p">(</span><span class="n">Assembly</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c"># Our component to be meta-modeled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;trig_calc&quot;</span><span class="p">,</span> <span class="n">Trig</span><span class="p">())</span>

       <span class="c"># Create meta_model for two responsese</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;trig_meta_model&quot;</span><span class="p">,</span> <span class="n">MetaModel</span><span class="p">(</span><span class="n">params</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="p">),</span>
                                              <span class="n">responses</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;f_x_sin&#39;</span><span class="p">,</span> <span class="s">&#39;f_x_cos&#39;</span><span class="p">)))</span>

        <span class="c"># Use Kriging for the f_x output</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trig_meta_model</span><span class="o">.</span><span class="n">surrogates</span><span class="p">[</span><span class="s">&#39;f_x_sin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trig_meta_model</span><span class="o">.</span><span class="n">surrogates</span><span class="p">[</span><span class="s">&#39;f_x_cos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FloatKrigingSurrogate</span><span class="p">()</span>

        <span class="c"># Training the MetaModel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;DOE_Trainer&quot;</span><span class="p">,</span> <span class="n">DOEdriver</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DOE_Trainer</span><span class="o">.</span><span class="n">DOEgenerator</span> <span class="o">=</span> <span class="n">FullFactorial</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DOE_Trainer</span><span class="o">.</span><span class="n">DOEgenerator</span><span class="o">.</span><span class="n">num_levels</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DOE_Trainer</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s">&quot;trig_calc.x&quot;</span><span class="p">,</span> <span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DOE_Trainer</span><span class="o">.</span><span class="n">add_response</span><span class="p">(</span><span class="s">&#39;trig_calc.f_x_sin&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DOE_Trainer</span><span class="o">.</span><span class="n">add_response</span><span class="p">(</span><span class="s">&#39;trig_calc.f_x_cos&#39;</span><span class="p">)</span>

        <span class="c"># Pass training data to the meta model.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;DOE_Trainer.case_inputs.trig_calc.x&#39;</span><span class="p">,</span> <span class="s">&#39;trig_meta_model.params.x&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;DOE_Trainer.case_outputs.trig_calc.f_x_sin&#39;</span><span class="p">,</span> <span class="s">&#39;trig_meta_model.responses.f_x_sin&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;DOE_Trainer.case_outputs.trig_calc.f_x_cos&#39;</span><span class="p">,</span> <span class="s">&#39;trig_meta_model.responses.f_x_cos&#39;</span><span class="p">)</span>

        <span class="c">#MetaModel Validation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;DOE_Validate&quot;</span><span class="p">,</span> <span class="n">DOEdriver</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DOE_Validate</span><span class="o">.</span><span class="n">DOEgenerator</span> <span class="o">=</span> <span class="n">Uniform</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DOE_Validate</span><span class="o">.</span><span class="n">DOEgenerator</span><span class="o">.</span><span class="n">num_samples</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DOE_Validate</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">((</span><span class="s">&quot;trig_meta_model.x&quot;</span><span class="p">,</span> <span class="s">&quot;trig_calc.x&quot;</span><span class="p">),</span>
                                        <span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DOE_Validate</span><span class="o">.</span><span class="n">add_response</span><span class="p">(</span><span class="s">&quot;trig_calc.f_x_sin&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DOE_Validate</span><span class="o">.</span><span class="n">add_response</span><span class="p">(</span><span class="s">&quot;trig_calc.f_x_cos&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DOE_Validate</span><span class="o">.</span><span class="n">add_response</span><span class="p">(</span><span class="s">&quot;trig_meta_model.f_x_sin&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DOE_Validate</span><span class="o">.</span><span class="n">add_response</span><span class="p">(</span><span class="s">&quot;trig_meta_model.f_x_cos&quot;</span><span class="p">)</span>

        <span class="c">#Iteration Hierarchy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="s">&#39;DOE_Trainer&#39;</span><span class="p">,</span> <span class="s">&#39;DOE_Validate&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DOE_Trainer</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;trig_calc&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DOE_Validate</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="s">&#39;trig_calc&#39;</span><span class="p">,</span> <span class="s">&#39;trig_meta_model&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>The iteration hierarchy is structurally the same as it would be with one
output. Even though there are multiple surrogate models for multiple outputs,
they are still contained within only one MetaModel component. So once again
there is the <tt class="docutils literal"><span class="pre">trig_calc</span></tt> MetaModel component separately added to each
workflow and the MetaModel component being added to the validation stage so
that comparative values may be generated.</p>
<p>In printing the information we have now included all four of the outputs. For
a Kriging Surrogate model, the answer is normally returned as a normal
distribution (Kriging Surrogate predicts both a mean and a standard deviation
for a given input). However, here we have slotted the
<tt class="docutils literal"><span class="pre">FloatKrigingSurrogate</span></tt>, which just returns the mean (or mu).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="n">sim</span> <span class="o">=</span> <span class="n">set_as_top</span><span class="p">(</span><span class="n">Simulation</span><span class="p">())</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="c">#This is how you can access any of the data</span>
    <span class="n">train_inputs</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">DOE_Trainer</span><span class="o">.</span><span class="n">case_inputs</span><span class="o">.</span><span class="n">trig_calc</span><span class="o">.</span><span class="n">x</span>
    <span class="n">train_actual_sin</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">DOE_Trainer</span><span class="o">.</span><span class="n">case_outputs</span><span class="o">.</span><span class="n">trig_calc</span><span class="o">.</span><span class="n">f_x_sin</span>
    <span class="n">train_actual_cos</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">DOE_Trainer</span><span class="o">.</span><span class="n">case_outputs</span><span class="o">.</span><span class="n">trig_calc</span><span class="o">.</span><span class="n">f_x_cos</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">DOE_Validate</span><span class="o">.</span><span class="n">case_inputs</span><span class="o">.</span><span class="n">trig_meta_model</span><span class="o">.</span><span class="n">x</span>
    <span class="n">actual_sin</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">DOE_Validate</span><span class="o">.</span><span class="n">case_outputs</span><span class="o">.</span><span class="n">trig_calc</span><span class="o">.</span><span class="n">f_x_sin</span>
    <span class="n">actual_cos</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">DOE_Validate</span><span class="o">.</span><span class="n">case_outputs</span><span class="o">.</span><span class="n">trig_calc</span><span class="o">.</span><span class="n">f_x_cos</span>
    <span class="n">predicted_sin</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">DOE_Validate</span><span class="o">.</span><span class="n">case_outputs</span><span class="o">.</span><span class="n">trig_meta_model</span><span class="o">.</span><span class="n">f_x_sin</span>
    <span class="n">predicted_cos</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">DOE_Validate</span><span class="o">.</span><span class="n">case_outputs</span><span class="o">.</span><span class="n">trig_meta_model</span><span class="o">.</span><span class="n">f_x_cos</span>

    <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">actual_sin</span><span class="p">,</span> <span class="n">predicted_sin</span><span class="p">,</span> <span class="n">actual_cos</span><span class="p">,</span> <span class="n">predicted_cos</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%1.3f</span><span class="s">, </span><span class="si">%1.3f</span><span class="s">, </span><span class="si">%1.3f</span><span class="s">, </span><span class="si">%1.3f</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
</pre></div>
</div>
<p>To view this example, and try running and modifying the code for yourself, you can download it here:
<a class="reference download internal" href="../../_downloads/multi_outs.py"><tt class="xref download docutils literal"><span class="pre">multi_outs.py</span></tt></a>.</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<a href="http://openmdao.org">
 <img src="../../_static/OpenMDAO_Logo_200w_padded.png"
border="0" alt="OpenMDAO Home"/>
</a>

  <h4>Previous topic</h4>
  <p class="topless"><a href="single_output.html"
                        title="previous chapter">Using a MetaModel Component</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../mdao/index.html"
                        title="next chapter">MDAO Architectures</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/tutorials/surrogate/mult_outputs.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../mdao/index.html" title="MDAO Architectures"
             >next</a> |</li>
        <li class="right" >
          <a href="single_output.html" title="Using a MetaModel Component"
             >previous</a> |</li>
  <li><a href="http://openmdao.org">OpenMDAO Home</a> &raquo;</li>
  
        <li><a href="../../index.html">OpenMDAO Documentation v0.13.0</a> &raquo;</li>

          <li><a href="../index.html" >OpenMDAO Tutorials</a> &raquo;</li>
          <li><a href="index.html" >MetaModel</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright none.
      Last updated on Apr 23, 2015.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>