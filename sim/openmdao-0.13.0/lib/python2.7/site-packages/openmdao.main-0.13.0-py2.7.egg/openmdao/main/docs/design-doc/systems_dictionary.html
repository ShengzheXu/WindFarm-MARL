<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Systems Dictionary &mdash; OpenMDAO Documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.13.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="OpenMDAO Documentation" href="../index.html" />
    <link rel="up" title="Design Doc Outline" href="index.html" />
    <link rel="next" title="Python Class Hierarchy" href="python_hierarchy.html" />
    <link rel="prev" title="Relationship between an Assembly and any Subassembly" href="assembly_subassembly.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="python_hierarchy.html" title="Python Class Hierarchy"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="assembly_subassembly.html" title="Relationship between an Assembly and any Subassembly"
             accesskey="P">previous</a> |</li>
  <li><a href="http://openmdao.org">OpenMDAO Home</a> &raquo;</li>
  
        <li><a href="../index.html">OpenMDAO Documentation v0.13.0</a> &raquo;</li>

          <li><a href="index.html" accesskey="U">Design Doc Outline</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="systems-dictionary">
<h1>Systems Dictionary<a class="headerlink" href="#systems-dictionary" title="Permalink to this headline">¶</a></h1>
<p>The following is a short summary of the types of systems that OpenMDAO will
create from your model when the System Hierarchy is formed. All systems
inherit from the System base class.</p>
<div class="section" id="simplesystem">
<h2>SimpleSystem<a class="headerlink" href="#simplesystem" title="Permalink to this headline">¶</a></h2>
<p>In the System Hierarchy, the <cite>SimpleSystem</cite> is analogous to a Component
in the iteration hierarchy. Every component in your model will have a
corresponding SimpleSystem in the system tree, provided that it&#8217;s in a
workflow. A SimpleSystem can execute the component and can provide the matrix
vector product of the Jacobian for the derivative solver. Both implicit and
explicit components are represented by SimpleSystems.</p>
</div>
<div class="section" id="serialsystem">
<h2>SerialSystem<a class="headerlink" href="#serialsystem" title="Permalink to this headline">¶</a></h2>
<p>A <cite>SerialSystem</cite> is a container system for one or more systems. As
the name implies, the component subsystems are executed sequentially in the
order directed by the connectivity graph. Every driver&#8217;s workflow has a
corresponding SerialSystem in the system hierarchy. These SerialSystems can
execute the workflow and can calculate a gradient between any inputs and
outputs of the component systems contained therein.</p>
<div class="figure align-center" id="id1">
<img alt="For a model containing a single component, OpenMDAO creates a SimpleSystem." src="../_images/arch_simplesystem-1.png" />
</div>
<p>The figure above shows the System Hierarchy for a model that has a single
Component in the Driver&#8217;s workflow. The topmost system is the SerialSystem for
the base driver&#8217;s workflow. This system contains a SimpleSystem as a
subsystem. The SimpleSystem represents the component <tt class="docutils literal"><span class="pre">'Comp1'</span></tt>.</p>
</div>
<div class="section" id="parallelsystem">
<h2>ParallelSystem<a class="headerlink" href="#parallelsystem" title="Permalink to this headline">¶</a></h2>
<p>Conversely, a <cite>ParallelSystem</cite> is a container system for two or more
systems that will be executed in parallel. These systems are used only when
OpenMDAO is run under MPI.</p>
<div class="figure align-center" id="id2">
<img alt="For a model containing a two components executed in parallel." src="../_images/arch_parallelsystem-1.png" />
</div>
<p>For this figure, we&#8217;ve built a model with two components that are not
connected; hence they can be executed in parallel. In this case, we have two
SimpleSystems that will be run in parallel, but in more complicated models
groups of components that execute in parallel with each other are
encapsulated in SerialSystems.</p>
<p>Both SerialSystem and ParallelSystem inherit from <cite>CompoundSystem,</cite> which
is never used in the System Hierarchy.</p>
</div>
<div class="section" id="paramsystem">
<h2>ParamSystem<a class="headerlink" href="#paramsystem" title="Permalink to this headline">¶</a></h2>
<p>If your model contains a driver that allows Parameters, then the system
hierarchy will contain a <cite>ParamSystem</cite> for each parameter. This system does
little calculation and is mostly a bookkeeping entity.</p>
<div class="figure align-center" id="id3">
<img alt="Parameters are contained in parameter systems." src="../_images/arch_paramsystem-1.png" />
</div>
<p>This figure shows a model where a component named <tt class="docutils literal"><span class="pre">'Comp1'</span></tt>, with input
<tt class="docutils literal"><span class="pre">'Comp1.x'</span></tt> and output <tt class="docutils literal"><span class="pre">'Comp1.y'</span></tt> is contained in the workflow of a driver
that has a parameter and an objective. The parameter gives us a ParamSystem
called <tt class="docutils literal"><span class="pre">'Comp1.x'</span></tt> which comes before <tt class="docutils literal"><span class="pre">'Comp1'</span></tt> in the subsystem execution
order. The objective also gives us another SimpleSystem that executes last.</p>
</div>
<div class="section" id="invarsystem">
<h2>InVarSystem<a class="headerlink" href="#invarsystem" title="Permalink to this headline">¶</a></h2>
<p>An <cite>InvarSystem</cite> is a system that is created for an input for which a gradient
has been requested when there is not a corresponding parameter and, hence, no
ParamSystem. An InVarSystem will be generated whenever you have a change in
scope, such as the presence of a subassembly, for which a gradient needs to be
calculated in the inner scope and given to the outer scope. In this case, the
InVarSystem marks the input variables in the subscope, much as the ParamSystem
marks them for a driver with parameters. InVarSystems are also created when you
call <tt class="docutils literal"><span class="pre">calc_gradient</span></tt> manually on a driver and give it inputs that are not
already parameters. This system also does little calculation.</p>
</div>
<div class="section" id="opaquesystem">
<h2>OpaqueSystem<a class="headerlink" href="#opaquesystem" title="Permalink to this headline">¶</a></h2>
<p>If a Driver requires derivatives from its workflow system, and if analytic
derivatives are not defined for all of its components or subdrivers, then the
System Hierarchy is generated differently. OpenMDAO will identify all of the
subsystems that can&#8217;t provide derivatives and group them into an
<cite>OpaqueSystem</cite>. The algorithm attempts to group them into the smallest
number of OpaqueSystems it can based on their connectivity. An OpaqueSystem
contains its own vectors, so when it executes, it must copy its variables
between the outer and the inner scope before and after it executes its
subsystems. The adjective <cite>opaque</cite> refers to how this system essentially
hides its internal variables from the systems above it in the hierarchy.</p>
<p>When an OpaqueSystem is linearized, it performs a finite difference between
its boundary inputs and boundary outputs and then caches that Jacobian for
use in the linear equations solution.</p>
<div class="figure align-center" id="id4">
<img alt="Opaque systems allow finite difference on submodels." src="../_images/arch_opaquesystem-1.png" />
</div>
<p>For this figure, we have expanded our model to contain two components
connected in series. We also have one parameter and one objective. The System
Hierarchy that results contains two more levels. The SimpleSystems for <tt class="docutils literal"><span class="pre">Comp1</span></tt>
and <tt class="docutils literal"><span class="pre">Comp2</span></tt> are grouped together in the SerialSystem <tt class="docutils literal"><span class="pre">FD_('Comp1',</span> <span class="pre">'Comp2')</span></tt>.
This SerialSystem is contained in an OpaqueSystem called <tt class="docutils literal"><span class="pre">('Comp1',</span> <span class="pre">'Comp2')</span></tt>
which can now provide derivatives by finite difference. There is also an
additional <cite>InVarSystem</cite> for <tt class="docutils literal"><span class="pre">'Comp1.x'</span></tt> in the OpaqueSystem&#8217;s SerialSystem
because of the scope change across the OpaqueSystem boundary.</p>
</div>
<div class="section" id="finitediffdriversystem">
<h2>FiniteDiffDriverSystem<a class="headerlink" href="#finitediffdriversystem" title="Permalink to this headline">¶</a></h2>
<p>Each driver actually contains two relevant systems. So far we&#8217;ve discussed
the &#8220;inner&#8221; one, which is the SerialSystem (or ParallelSystem) that is owned
by its workflow. The driver also contains a system that defines its behavior
when placed as a subdriver into a larger model. For the majority of drivers
(such as Optimizers), there isn&#8217;t an easy analytical way to calculate
derivatives across it without executing it via a finite difference. These
drivers contain a <cite>FiniteDiffDriverSystem</cite> to define their external
behavior, essentially marking them to be included in any OpaqueSystems that
are generated.</p>
<p>The FiniteDiffDriverSystem always contains the workflow&#8217;s system as a
subsystem. It executes by running its workflow system, but it cannot provide
derivatives and relies on being contained in an OpaqueSystem.</p>
<div class="figure align-center" id="id5">
<img alt="Some drivers must be finite differenced." src="../_images/arch_finitedifferencesystem-1.png" />
</div>
<p>In this figure, we have taken the previous model and moved the components into a
subdriver called <tt class="docutils literal"><span class="pre">sub</span></tt> (denoted by the upside-down home plate). This driver
cannot calculate its derivatives, so it is placed in the OpaqueSystem
<tt class="docutils literal"><span class="pre">('sub',)</span></tt>, which contains a SerialSystem <tt class="docutils literal"><span class="pre">FD_('sub',)</span></tt> that contains
<tt class="docutils literal"><span class="pre">'sub'</span></tt>. As before, we also get an InVarSystem for the gradient input because
of the OpaqueSystem scope change.</p>
<p>Note that if our <tt class="docutils literal"><span class="pre">sub</span></tt> driver also needed derivatives (a nested Optimizer
might), then an additional OpaqueSystem layer would be required. This
is the only situation that allows &#8220;nested&#8221; OpaqueSystems.</p>
<p>FiniteDiffDriverSystem is derived from <cite>DriverSystem</cite>, but that class is
never used on its own.</p>
</div>
<div class="section" id="transparentdriversystem">
<h2>TransparentDriverSystem<a class="headerlink" href="#transparentdriversystem" title="Permalink to this headline">¶</a></h2>
<p>Some drivers can be differentiated by including their workflow&#8217;s components in
the parent driver&#8217;s gradient solution in some manner. These drivers inherit
from <cite>TransparentDriverSystem</cite>. Presently, the TransparentDriverSystem
is found only when using Driver as a subdriver. Driver runs its workflow
once, so for derivative calculation, its variables can be added to the system
of equations and solved together. The matrix vector product operation
proceeds across the TransparentDriverSystem boundary; hence, it is called
<cite>transparent.</cite></p>
</div>
<div class="section" id="solversystem">
<h2>SolverSystem<a class="headerlink" href="#solversystem" title="Permalink to this headline">¶</a></h2>
<p>Solvers are a special case and form a subclass of
TransparentDriverSystem called the <cite>SolverSystem</cite>. As before, the
SolverSystem always contains the workflow&#8217;s system as a subsystem, and these
components contribute variables and equations to the gradient solution. In
addition, the solver&#8217;s equality constraint is given a special system called
the <cite>EqConstraintSystem</cite>. This system houses the solver&#8217;s implicit
relationship.</p>
</div>
<div class="section" id="eqconstraintsystem">
<h2>EqConstraintSystem<a class="headerlink" href="#eqconstraintsystem" title="Permalink to this headline">¶</a></h2>
<p>Every Solver system has an EqConstraintSystem for each of its equality
constraints. These systems define the implicit relationship between the
solver&#8217;s parameter (which behaves as an implicit state in the coupled
gradient solution) and the solver&#8217;s equality constraint output (which
behaves as a residual).</p>
<div class="figure align-center" id="id6">
<img alt="Coupled derivatives for subsolvers." src="../_images/arch_solversystem-1.png" />
</div>
<p>In this figure, we have replaced the undifferentiable <tt class="docutils literal"><span class="pre">sub</span></tt> with a solver
such as NewtonSolver. Hence, there are no more OpaqueSystems. The solver&#8217;s
outer system is represented by the upside-down home plate symbol, and it
contains a SerialSystem for its workflow. We&#8217;ve given <tt class="docutils literal"><span class="pre">'Comp1'</span></tt> another
input <tt class="docutils literal"><span class="pre">'Comp1.z'</span></tt> to be varied by the solver to drive the output to zero.
The final item in the solver&#8217;s SerialSystem is the EqConstraintSystem
<tt class="docutils literal"><span class="pre">'_pseudo_1'</span></tt>.</p>
<p>Note that equality constraints can also be added to non-differentiable
drivers such as optimizers. While the EqConstraintSystem is still created for
these, the state/residual behavior occurs only under solvers.</p>
</div>
<div class="section" id="assemblysystem">
<h2>AssemblySystem<a class="headerlink" href="#assemblysystem" title="Permalink to this headline">¶</a></h2>
<p>Finally, let&#8217;s take the <tt class="docutils literal"><span class="pre">solver</span></tt> driver and put it in an assembly. In the
system hierarchy, an assembly is represented by an <cite>AssemblySystem</cite>. An
assembly is opaque in nature, with a scope that is inaccessible from the
outside, so the AssemblySystem has an inward and an outward facing system.
The outer system is the AssemblySystem, and it is opaque. Variables must be
passed between the inner and the outer scope before and after execution, though
the only ones that need to be passed are the variables on the assembly
boundary. The inner assembly system is either a SerialSystem or a
ParallelSystem. The gradient of an AssemblySystem must be calculated by
asking the inner system for the gradient of the boundary variables. This
invokes a separate linear solution from the outer solve, though it is solved
during &#8220;linearize&#8221; and cached. Note that this may incur a higher memory
footprint over just putting everything in one assembly, but assemblies are
useful for encapsulation.</p>
<div class="figure align-center" id="id7">
<img alt="Sub assembly scope." src="../_images/arch_assemblysystem-1.png" />
</div>
<p>For this final figure, we have taken the subdriver <tt class="docutils literal"><span class="pre">'solver'</span></tt> and placed it
(along with <tt class="docutils literal"><span class="pre">'Comp1'</span></tt> and <tt class="docutils literal"><span class="pre">'Comp2'</span></tt>) into a subassembly. Since it&#8217;s the
first driver in the assembly now, the solver&#8217;s name is now <tt class="docutils literal"><span class="pre">'driver'</span></tt>. Now
the System Hierarchy has the inner and the outer systems for the assembly.
Since we kept the top driver in the top, we needed to create passthroughs for
the <tt class="docutils literal"><span class="pre">'Comp1.x'</span></tt> and <tt class="docutils literal"><span class="pre">'Comp2.y'</span></tt> variables; these are called <tt class="docutils literal"><span class="pre">'Sub.x'</span></tt> and
<tt class="docutils literal"><span class="pre">'Sub.y'</span></tt>. Boundary variables that are relevant in gradient calculations of
the outer system show up as the InVarSystem <tt class="docutils literal"><span class="pre">'x'</span></tt> and the VarSystem <tt class="docutils literal"><span class="pre">'y'</span></tt>.
Everything below driver is as above, though the EqConstraintSystem&#8217;s name is
now <tt class="docutils literal"><span class="pre">'_pseudo_0'</span></tt> because each assembly has a separate counter for
PseudoComps.</p>
</div>
<div class="section" id="varsystem">
<h2>VarSystem<a class="headerlink" href="#varsystem" title="Permalink to this headline">¶</a></h2>
<p>A <cite>VarSystem</cite> is a system that is created for an assembly boundary output
for which a derivative is required in an outer scope. It performs little calculation.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<a href="http://openmdao.org">
 <img src="../_static/OpenMDAO_Logo_200w_padded.png"
border="0" alt="OpenMDAO Home"/>
</a>

  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Systems Dictionary</a><ul>
<li><a class="reference internal" href="#simplesystem">SimpleSystem</a></li>
<li><a class="reference internal" href="#serialsystem">SerialSystem</a></li>
<li><a class="reference internal" href="#parallelsystem">ParallelSystem</a></li>
<li><a class="reference internal" href="#paramsystem">ParamSystem</a></li>
<li><a class="reference internal" href="#invarsystem">InVarSystem</a></li>
<li><a class="reference internal" href="#opaquesystem">OpaqueSystem</a></li>
<li><a class="reference internal" href="#finitediffdriversystem">FiniteDiffDriverSystem</a></li>
<li><a class="reference internal" href="#transparentdriversystem">TransparentDriverSystem</a></li>
<li><a class="reference internal" href="#solversystem">SolverSystem</a></li>
<li><a class="reference internal" href="#eqconstraintsystem">EqConstraintSystem</a></li>
<li><a class="reference internal" href="#assemblysystem">AssemblySystem</a></li>
<li><a class="reference internal" href="#varsystem">VarSystem</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="assembly_subassembly.html"
                        title="previous chapter">Relationship between an Assembly and any Subassembly</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="python_hierarchy.html"
                        title="next chapter">Python Class Hierarchy</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/design-doc/systems_dictionary.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="python_hierarchy.html" title="Python Class Hierarchy"
             >next</a> |</li>
        <li class="right" >
          <a href="assembly_subassembly.html" title="Relationship between an Assembly and any Subassembly"
             >previous</a> |</li>
  <li><a href="http://openmdao.org">OpenMDAO Home</a> &raquo;</li>
  
        <li><a href="../index.html">OpenMDAO Documentation v0.13.0</a> &raquo;</li>

          <li><a href="index.html" >Design Doc Outline</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright none.
      Last updated on Apr 23, 2015.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>