<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Recording Your Inputs and Outputs &mdash; OpenMDAO Documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.13.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="OpenMDAO Documentation" href="../../index.html" />
    <link rel="up" title="Simple Optimization" href="index.html" />
    <link rel="next" title="Adding Derivatives to Your Components" href="derivatives.html" />
    <link rel="prev" title="Building a Model - Executing a Design of Experiment (DOE)" href="doe.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="derivatives.html" title="Adding Derivatives to Your Components"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="doe.html" title="Building a Model - Executing a Design of Experiment (DOE)"
             accesskey="P">previous</a> |</li>
  <li><a href="http://openmdao.org">OpenMDAO Home</a> &raquo;</li>
  
        <li><a href="../../index.html">OpenMDAO Documentation v0.13.0</a> &raquo;</li>

          <li><a href="../index.html" >OpenMDAO Tutorials</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Simple Optimization</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="recording-your-inputs-and-outputs">
<span id="index-0"></span><h1>Recording Your Inputs and Outputs<a class="headerlink" href="#recording-your-inputs-and-outputs" title="Permalink to this headline">Â¶</a></h1>
<p>In the previous example, we showed how to use a <cite>DOEdriver</cite> to vary parameters and plot the values from the DOE using the <cite>case_input</cite> and <cite>case_output</cite> variable trees. Another way to work with the DOE data is to record it to a file, and then make your plots in a
post processing step.</p>
<p>Let&#8217;s re-run the DOE example from the previous tutorial: a Unifrom DOE of a Paraboloid component. The
only difference from before is that we will specify a <a class="reference internal" href="../../srcdocs/packages/openmdao.lib.html#openmdao-lib-casehandlers-jsoncase-py"><em>JSONCaseRecorder</em></a>, which will save off all the data from our run into a
file, named by the <cite>filename</cite> argument. The following <cite>script &lt;/../examples/openmdao.examples.simple/openmdao/examples/simple/case_recorders.py&gt;</cite> will run the DOE for you, and should result
in a file being created called <cite>doe.json</cite>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">OpenMDAO also constains a <a class="reference internal" href="../../srcdocs/packages/openmdao.lib.html#openmdao-lib-casehandlers-jsoncase-py"><em>BSONCaseRecorder</em></a> recorder
which records the data in a more compact format.</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">openmdao.main.api</span> <span class="kn">import</span> <span class="n">Assembly</span><span class="p">,</span> <span class="n">Component</span>
<span class="kn">from</span> <span class="nn">openmdao.lib.drivers.api</span> <span class="kn">import</span> <span class="n">DOEdriver</span>
<span class="kn">from</span> <span class="nn">openmdao.lib.doegenerators.api</span> <span class="kn">import</span> <span class="n">Uniform</span>

<span class="kn">from</span> <span class="nn">openmdao.examples.simple.paraboloid</span> <span class="kn">import</span> <span class="n">Paraboloid</span>

<span class="kn">from</span> <span class="nn">openmdao.lib.casehandlers.api</span> <span class="kn">import</span> <span class="n">JSONCaseRecorder</span>

<span class="k">class</span> <span class="nc">Analysis</span><span class="p">(</span><span class="n">Assembly</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;paraboloid&#39;</span><span class="p">,</span> <span class="n">Paraboloid</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;driver&#39;</span><span class="p">,</span> <span class="n">DOEdriver</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">DOEgenerator</span> <span class="o">=</span> <span class="n">Uniform</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s">&#39;paraboloid.x&#39;</span><span class="p">,</span> <span class="n">low</span><span class="o">=-</span><span class="mi">50</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s">&#39;paraboloid.y&#39;</span><span class="p">,</span> <span class="n">low</span><span class="o">=-</span><span class="mi">50</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_response</span><span class="p">(</span><span class="s">&#39;paraboloid.f_xy&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">recorders</span> <span class="o">=</span> <span class="p">[</span><span class="n">JSONCaseRecorder</span><span class="p">(</span><span class="n">out</span><span class="o">=</span><span class="s">&#39;doe.json&#39;</span><span class="p">)]</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c">#-----------------------------</span>
    <span class="c"># Run analysis</span>
    <span class="c">#-----------------------------</span>
    <span class="kn">import</span> <span class="nn">os</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&#39;doe.json&#39;</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s">&#39;doe.json&#39;</span><span class="p">)</span>

    <span class="n">analysis</span> <span class="o">=</span> <span class="n">Analysis</span><span class="p">()</span>

    <span class="n">analysis</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Once you have the <cite>doe.json</cite> file, then you can start to set up some post processing scripts to
let you interpret your data. The next script just prints the data to your screen.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">openmdao.lib.casehandlers.api</span> <span class="kn">import</span> <span class="n">CaseDataset</span>

<span class="c">#----------------------------------------------------</span>
<span class="c"># Print out history of our objective for inspection</span>
<span class="c">#----------------------------------------------------</span>
<span class="n">case_dataset</span> <span class="o">=</span> <span class="n">CaseDataset</span><span class="p">(</span><span class="s">&#39;doe.json&#39;</span><span class="p">,</span> <span class="s">&#39;json&#39;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">case_dataset</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">by_case</span><span class="p">()</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>

<span class="k">for</span> <span class="n">case</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;x: </span><span class="si">%f</span><span class="s">, y:</span><span class="si">%f</span><span class="s">, f_xy:</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">case</span><span class="p">[</span><span class="s">&#39;paraboloid.x&#39;</span><span class="p">],</span> <span class="n">case</span><span class="p">[</span><span class="s">&#39;paraboloid.y&#39;</span><span class="p">],</span> <span class="n">case</span><span class="p">[</span><span class="s">&#39;paraboloid.f_xy&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>To open the data file, we use a <a class="reference internal" href="../../srcdocs/packages/openmdao.lib.html#openmdao-lib-casehandlers-query-py"><em>CaseDataset</em></a> object. The arguments
for creating a <cite>CaseDataset</cite> object are the file name and file type. <cite>CaseDataset</cite> objects have a variety
of methods for controlling what information is read from the file. In this example, we use <cite>by_case</cite>
to specify that the data should be returned as a list of dictionaries, where each item of the list is a single case and variables can be accessed by row. The <cite>fetch</cite> executes the query to read the data into memory.</p>
<p>In the DOE tutorial, we showed how to generate a 3D surface plot using the <cite>case_input</cite> and <cite>case_output</cite> variable trees of a <cite>DOEdriver</cite>. Below is an example of generating the same plot using <cite>CaseDataset</cite> objects.
Retrieve the data using a <cite>CaseDataset</cite> object. We use <cite>by_variable</cite> to arrange the data by variable, rather than
by case order. Notice that we&#8217;re using the exact same data file, without re-running to get it again.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">p</span>

<span class="kn">from</span> <span class="nn">openmdao.lib.casehandlers.api</span> <span class="kn">import</span> <span class="n">CaseDataset</span>

<span class="n">case_dataset</span> <span class="o">=</span> <span class="n">CaseDataset</span><span class="p">(</span><span class="s">&#39;doe.json&#39;</span><span class="p">,</span> <span class="s">&#39;json&#39;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">case_dataset</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">by_variable</span><span class="p">()</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
<span class="n">x</span>    <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;paraboloid.x&#39;</span><span class="p">]</span>
<span class="n">y</span>    <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;paraboloid.y&#39;</span><span class="p">]</span>
<span class="n">f_xy</span>    <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;paraboloid.f_xy&#39;</span><span class="p">]</span>

<span class="n">p</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">Axes3D</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

<span class="n">every_10</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))[::</span><span class="mi">10</span><span class="p">]</span>


<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">every_10</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span><span class="mi">60</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span><span class="mi">60</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="o">-</span><span class="mi">1000</span><span class="p">,</span><span class="mi">6000</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

    <span class="c">#3d surface plot</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot_trisurf</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="n">i</span><span class="p">],</span><span class="n">y</span><span class="p">[:</span><span class="n">i</span><span class="p">],</span><span class="n">f_xy</span><span class="p">[:</span><span class="n">i</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

    <span class="n">p</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mo">005</span><span class="p">)</span> <span class="c">#slow things down so you can see the changes</span>

<span class="n">p</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>
</pre></div>
</div>
<p>OpenMDAO has convenience functions for two common post processing steps: writing data to a CSV file or printing out detailed information about cases. These functions, <a class="reference internal" href="../../srcdocs/packages/openmdao.lib.html#openmdao-lib-casehandlers-csv-post-processor-py"><em>caseset_query_to_csv</em></a> and <a class="reference internal" href="../../srcdocs/packages/openmdao.lib.html#openmdao-lib-casehandlers-dump-post-processor-py"><em>caseset_query_dump</em></a>, both require the data returned from executing a query. <cite>caseset_query_to_csv</cite> allows for an additional argument to specify the name of the CSV file to be created.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">openmdao.lib.casehandlers.api</span> <span class="kn">import</span> <span class="n">CaseDataset</span>
<span class="kn">from</span> <span class="nn">openmdao.lib.casehandlers.api</span> <span class="kn">import</span> <span class="n">caseset_query_to_csv</span>
<span class="kn">from</span> <span class="nn">openmdao.lib.casehandlers.api</span> <span class="kn">import</span> <span class="n">caseset_query_dump</span>

<span class="n">case_dataset</span> <span class="o">=</span> <span class="n">CaseDataset</span><span class="p">(</span><span class="s">&#39;doe.json&#39;</span><span class="p">,</span> <span class="s">&#39;json&#39;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">case_dataset</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">by_case</span><span class="p">()</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>

<span class="n">caseset_query_to_csv</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s">&#39;doe.csv&#39;</span><span class="p">)</span>
<span class="n">caseset_query_dump</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p>By default OpenMDAO will record all variables in the model.  This can get to be a lot
of data and the associated file can be quite large.  You can change the default behavior
by modifying the <tt class="docutils literal"><span class="pre">recording_options</span></tt> variable tree in the top level assembly.  There
are three options:</p>
<table border="1" class="docutils">
<colgroup>
<col width="34%" />
<col width="9%" />
<col width="57%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">save_problem_formulation</span></tt></td>
<td>True</td>
<td>Save parameters, objectives, constraints, etc.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">includes</span></tt></td>
<td>[&#8216;*&#8217;]</td>
<td>Variables to include</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">excludes</span></tt></td>
<td>[ ]</td>
<td>Variables to exclude (processed after includes)</td>
</tr>
</tbody>
</table>
<p>Also, if you want to reduce
the data processed for a specific post processing scenario you can write out
a new file based on cases and/or variables specified in a query by replacing
<cite>fetch()</cite> with <cite>write(filename)</cite>.  You can optionally specify a format for the
new file (<tt class="docutils literal"><span class="pre">json</span></tt> or <tt class="docutils literal"><span class="pre">bson</span></tt>), so this facility can also be used for changing
the format of an existing case dataset file.</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<a href="http://openmdao.org">
 <img src="../../_static/OpenMDAO_Logo_200w_padded.png"
border="0" alt="OpenMDAO Home"/>
</a>

  <h4>Previous topic</h4>
  <p class="topless"><a href="doe.html"
                        title="previous chapter">Building a Model - Executing a Design of Experiment (DOE)</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="derivatives.html"
                        title="next chapter">Adding Derivatives to Your Components</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/tutorials/optimization/case_recorders.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="derivatives.html" title="Adding Derivatives to Your Components"
             >next</a> |</li>
        <li class="right" >
          <a href="doe.html" title="Building a Model - Executing a Design of Experiment (DOE)"
             >previous</a> |</li>
  <li><a href="http://openmdao.org">OpenMDAO Home</a> &raquo;</li>
  
        <li><a href="../../index.html">OpenMDAO Documentation v0.13.0</a> &raquo;</li>

          <li><a href="../index.html" >OpenMDAO Tutorials</a> &raquo;</li>
          <li><a href="index.html" >Simple Optimization</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright none.
      Last updated on Apr 23, 2015.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>