<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Linear Solvers for Derivative Calculation &mdash; OpenMDAO Documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.13.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="OpenMDAO Documentation" href="../index.html" />
    <link rel="up" title="Design Doc Outline" href="index.html" />
    <link rel="next" title="Case Recording Structure" href="case_recording.html" />
    <link rel="prev" title="Flattenable vs. Non-flattenable Variables" href="flattenable.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="case_recording.html" title="Case Recording Structure"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="flattenable.html" title="Flattenable vs. Non-flattenable Variables"
             accesskey="P">previous</a> |</li>
  <li><a href="http://openmdao.org">OpenMDAO Home</a> &raquo;</li>
  
        <li><a href="../index.html">OpenMDAO Documentation v0.13.0</a> &raquo;</li>

          <li><a href="index.html" accesskey="U">Design Doc Outline</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="linear-solvers-for-derivative-calculation">
<h1>Linear Solvers for Derivative Calculation<a class="headerlink" href="#linear-solvers-for-derivative-calculation" title="Permalink to this headline">¶</a></h1>
<p>The wrapper code for all linear solvers can be found in
<tt class="docutils literal"><span class="pre">openmdao.main/src/openmdao/main/linearsolver.py</span></tt>. Their base class is LinearSolver.</p>
<p>The OpenMDAO System Hierarchy uses the LinearSolver class to solve a linear
system of equations that is assembled from the components, drivers, and
assemblies in an OpenMDAO model via the system tree. Such a linear system is
solved for the derivatives of a set of given outputs with respect to inputs.
Whenever an optimizer requests a gradient, a LinearSolver calculates it. This
solver also calculates the direction to take the next step during iteration of
a Newton solver.</p>
<p>A LinearSolver has two methods that are called by the systems:</p>
<p><strong>calc_gradient</strong> &#8211; return a Jacobian of outputs with respect to inputs. The
return format can be an array or a dict as specified by <tt class="docutils literal"><span class="pre">return_format</span></tt>.</p>
<p><strong>solve</strong> &#8211; solve the current linear system with a custom right-hand-side
vector. This is used by Newton solvers.</p>
<p>OpenMDAO currently has three linear solvers, selectable in any Driver by
changing the <tt class="docutils literal"><span class="pre">lin_solver</span></tt> enum in <tt class="docutils literal"><span class="pre">gradient_options</span></tt>. All linear solvers
can be run in either forward or adjoint mode by setting
<tt class="docutils literal"><span class="pre">derivative_direction</span></tt>. If you don&#8217;t set this, OpenMDAO will pick the best
direction based on the width of the parameter and response spaces.</p>
<div class="section" id="scipy-gmres">
<h2>Scipy GMRES<a class="headerlink" href="#scipy-gmres" title="Permalink to this headline">¶</a></h2>
<p>Scipy GMRES is the default linear solver used by OpenMDAO; it was also the method
introduced in OpenMDAO 0.9.0 and continued as the only linear solver through
version 0.10.3.2. GMRES is an iterative method that relies on successive
multiplication of the right-hand-side vector by the Jacobian. If you have no
cycles in your model, then it will converge after a number of iterations
equal to the deepest number of components that it has to traverse from input
to response.</p>
<p>You can specify the tolerance for GMRES by setting <cite>atol</cite> in the
<tt class="docutils literal"><span class="pre">gradient_options</span></tt>. The value of atol tells GMRES what values of the matrix
vector product return to ignore when determining the next direction to go. If
you have very small derivatives at any point in your model, you may need to
decrease this number. If you have a large number of components, you may also
need to increase <cite>maxiter</cite>.</p>
<p>Scipy GMRES is not supported in MPI. If you select it for a driver that is
running under MPI, the PetSC KSP solver will be used instead.</p>
</div>
<div class="section" id="petsc-ksp">
<h2>PetSC KSP<a class="headerlink" href="#petsc-ksp" title="Permalink to this headline">¶</a></h2>
<p>This linear solver uses PetSC&#8217;s KSP solver. KSP supports a number of different
Krylov Space methods, but we are just using GMRES, so the solution method is
the same as the Scipy GMRES solver. However, the PetSC package provides
support for solving a linear problem when the incoming and solution vectors
are distributed across multiple processes in MPI.</p>
<p>You can specify the tolerance for KSP by setting <cite>atol</cite> or <cite>rtol</cite> in the
<tt class="docutils literal"><span class="pre">gradient_options</span></tt> (i.e., absolute and relative tolerances). They likely
function the same way as in GMRES. If you have a large number of components, you
may also need to increase <cite>maxiter</cite>.</p>
<p>The KSP solvers also add formal support for preconditioning; this will be
supported in OpenMDAO soon.</p>
<p>PetSC KSP is the default linear solver for any driver executing under MPI.
However, you can also use it for serial execution provided that you have
installed PetSC and PetSC4py, openMPI and MPI4py.</p>
</div>
<div class="section" id="linear-gauss-seidel">
<h2>Linear Gauss-Seidel<a class="headerlink" href="#linear-gauss-seidel" title="Permalink to this headline">¶</a></h2>
<p>The Linear Gauss-Seidel linear solver is essentially a chain rule solver. It
iterates over a workflow in dataflow order and calls the matrix vector
product. For a model without cycles, one iteration is enough for an accurate
derivative, and you should set maxiter to 1 in this case.</p>
<p>This currently doesn&#8217;t work in MPI, and it might require enough modifications
that we just implement a new linear solver to use under MPI.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<a href="http://openmdao.org">
 <img src="../_static/OpenMDAO_Logo_200w_padded.png"
border="0" alt="OpenMDAO Home"/>
</a>

  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Linear Solvers for Derivative Calculation</a><ul>
<li><a class="reference internal" href="#scipy-gmres">Scipy GMRES</a></li>
<li><a class="reference internal" href="#petsc-ksp">PetSC KSP</a></li>
<li><a class="reference internal" href="#linear-gauss-seidel">Linear Gauss-Seidel</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="flattenable.html"
                        title="previous chapter">Flattenable vs. Non-flattenable Variables</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="case_recording.html"
                        title="next chapter">Case Recording Structure</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/design-doc/linear_solvers.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="case_recording.html" title="Case Recording Structure"
             >next</a> |</li>
        <li class="right" >
          <a href="flattenable.html" title="Flattenable vs. Non-flattenable Variables"
             >previous</a> |</li>
  <li><a href="http://openmdao.org">OpenMDAO Home</a> &raquo;</li>
  
        <li><a href="../index.html">OpenMDAO Documentation v0.13.0</a> &raquo;</li>

          <li><a href="index.html" >Design Doc Outline</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright none.
      Last updated on Apr 23, 2015.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>